# 키오스크 
상품을 주문할 수 있는 키오스크를 구현해보며 객체지향 및 클린 아키텍쳐 학습
## 개발 환경
- JDK 17
- Spring Boot 3.3.1
- Spring Data JPA
- Gradle 8.5
- H2
- JUnit

## 프로젝트 구조
~~~
src/
  +- cart/              # 장바구니 도메인
    +- application/       # 비지니스 로직 관련
    +- domain/            # 도메인 모음
    +- adapter/             # 외부 통신 (구현체 리포지토리 등)
  +- common/            # 공통 로직
    +- exception/       
    +- lock/            
  +- config/            # 설정 관련
  +- order/             # 주문 도메인
  +- payment/           # 결제 도메인
  +- product/           # 상품 도메인
  +- util/              # 유틸 클래스 모음
  +- ui/              # 콘솔 입/출력 관련 클래스
    +- input/
    +- output/
  - Application.java
~~~
각 도메인별로 패키지를 구성하고 **도메인간 경계를 명확히 하기 위헤 도메인 의존 관계는 애그리 거트 내에서는 직접적으로 의존**하도록, **다른 애그리거트의 경우에는 ID 값으로 간접 의존**하도록 구성

## 클래스 설명
* **Kiosk**: 주문 프로세스가 정의된 클래스. Input과 Output을 관리하며 KioskRunner에게 실제 내부 동작을 위임.
* **KioskRunner**: 키오스크를 실행하는 클래스.
* **KioskProcessHandler**: 각 도메인의 서비스를 주입받아 주문 프로세스의 데이터를 핸들링.

## 구현 관련
* **도메인 서비스 간 통신은 DTO를 통해 이루어지며** 외부에서 직접 도메인을 조작할 수 없도록 하여 느슨한 결합을 유지.
* 주문 시 상품 **재고 감소는 상품 번호별로 분산 락을 적용**하여, 상품 도메인에 대한 다른 작업이 블로킹되지 않도록 구현.
  * **재고 감소 작업은 독립적인 트랜잭션으로 실행**되며, 주문 로직에서 예외가 발생할 경우 재고 롤백 이벤트를 발생시켜 독립적으로 처리.
* 장바구니 도메인을 활용하여 View 클래스에서 상품 추가나 주문 시 장바구니를 기반으로 동작하도록 구현.
* 도메인 조작은 해당 도메인의 서비스에서만 수행하고, View의 동작은 KioskProcessHandler에서 제어하여 KioskRunner에서는 입출력만 담당.
* Command 객체를 통해 사용자 입력을 처리하여 **외부에서의 입력값 조작을 방지**.
* KioskRunner를 사용하여 애플리케이션 실행 시 자동으로 KioskRunner가 동작하도록 설정.

## 기타
* **MemoryLockManager**: LockManager 인터페이스를 구현한 메모리 기반 락을 생성하여 멀티 스레드 테스트를 통해 동시성 관련 테스트 진행.